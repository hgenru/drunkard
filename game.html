<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <script type="text/javascript" src="res/engine.js"></script>
        <script type="text/javascript" src="res/move.js"></script>
        <link type="text/css" rel="stylesheet" href="res/game.css"/>
    </head>
    <body>
        <script type="text/javascript">
            window.onload = function() {
                var raw_cards = [[2, "club"],[2, "diamond"],[3, "spade"],[4, "spade"],[5, "diamond"],[6, "club"],[8, "spade"]];
                cards = generate_cards(raw_cards);
                game = new Game(cards, ["Суйка", "Анон"], ["#04B431", "#FA5858"]);
            };
            function step() {
                var step_result = game.make_step();
                if (step_result.length <= 1) { win(step_result[0]); return; }
                var card_container = document.getElementsByName("game_card_container")[0];
                clear_overlay();
                for (var i=0; i < step_result[2].length; i++) {
                    var new_image = document.createElement('img');
                    id_ = step_result[2][i].cost + "_of_" + step_result[2][i].suit;
                    new_image.src = "res/cards/" + id_ + "s.png";
                    new_image.id = id_
                    new_image.className = "card";
                    new_image.style.borderColor = step_result[3][i].color;
                    card_container.appendChild(new_image);
                    if (step_result[2][i] == step_result[1]) {
                        console.log(id_)
                        move(id_)
                            .duration(1000)
                            .scale(1.1)
                            .end();
                    }
                }
                var overlay_back = move('#game_overlay.overlay')
                    .set('visibility', 'hidden')
                    .delay(300)
                    .end();
                move('#game_overlay.overlay')
                    .set('visibility', 'visible')
                    .delay(300)
                    .then(overlay_back)
                    .end();
            }
            function clear_overlay() {
                var card_container = document.getElementsByName("game_card_container")[0];
                var old_entries = document.querySelectorAll(".card");
                for (var i=0; i < old_entries.length; i++) {
                    var entry = old_entries[i];
                    if (entry) {
                        card_container.removeChild(entry);
                    }
                }
            }
            function win(player) {
                clear_overlay()
                var msg = document.createElement('h1');
                msg.innerHTML = player + " win!";
                result = document.getElementById("game_result");
                result.appendChild(msg);
                move("#game_overlay.overlay")
                    .set('visibility', 'visible')
                    .end();;
            }
        </script>
        <div class="container">
            <div class="table">
                <div class="table_container "><div class="step_button" onclick="step()"/></div></div>
            </div>
            <div id="game_overlay" class="overlay">
                <div id="game_result" class="result">
                    <div name="game_card_container" class="card_container">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
